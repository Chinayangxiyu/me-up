# 分布式系统相关理论

##  CAP定理
概述：CAP定理是指分布式系统只能同时满足C（一致性），A（可用性），P（分区容错性）中两项。


分区容错性：是指因为网络等原因，整个集群被划分为不同的区域。  
如果不允许出现分区容错性，就不能发生分区，那么只有一个节点的时候才能满足这种情况；这样就  
分布式就退化为单节点的服务了。

在CA中做权衡：如果允许出现不同的分区，那么肯定会出现某时刻不同分区数据不一致，整个集群是否可用的问题。
综上所述：分布式系统必须满足分区容错性；因此产生的强一致性和可用性问题，两者不可兼得；
需要取舍。一半保证可用性，而使用最终一致性来解决问题。

##  BASE
对CAP中一致性、可用性权衡的结果。
BA（基本可用）：系统出现故障时候，牺牲一部分可用性，比如响应时间变长，功能降级。
S（弱状态）：数据副本之间同步存在延时。
E（最终一致性）：不同节点的数据副本保证最终一致性。

## 一致性协议
为了保证分布式一同一致性而衍生了一些算法，依次保证分布式系统的一致性。

### 2PC
将单机的事务提交切分成了请求、提交两个阶段。事务参与者通过和协调者通信，反馈状态；协调者  
根据参与者的反馈信息去控制事务提交、回滚。

优点：简单、方便；  
缺点：同步阻塞、脑裂、单点问题。

### 3PC
因为2PC的问题，3PC将事务提交分成了三个阶段请求、准备、提交；也是由协调者控制事务。


### paxos
三种角色：proposer（提案人）、acceptor（接受者）、learner（学习者）。
超过半数响应，acceptor承诺在接收编号为n的提议后不再接收比n小的提议。
总结：  
（1）proposer生成一个新的proposal ID，并向accepter广播提案；
（2）

(参考)\[https://zhuanlan.zhihu.com/p/31780743]
(11)[https://www.zhihu.com/question/19787937/answer/1258191694]
https://zhuanlan.zhihu.com/p/29706905
### ZAB协议
为zookeeper设计的一致性协议，并不通用。


