# 一、rabbit基础

## 1.1 简介
Rabbit是才有Erlang语言实现AMQP（Advanced Message Queuing Protocol，高级消息队列协议）  
的消息中间件；AMQP是一个公开的标准。

RabbitMQ具有如下特性：  
（1）可靠性：用持久化、传输确认、发布确认等机制实现；  
（2）灵活的路由：交换器和队列的组合灵活多变；  
（3）扩展性：支持集群和动态扩容；  
（4）高可用性：队列镜像保障集群可用性；  
（5）多种协议：除了支持AMQP协议，还支持STOMP、MQTT等协议；  
（6）多语言客户端、管理界面、插件机制支持动态扩展。

## 1.2 相关概念
### 生产者
创建、发布消息，消息一般包含两部分，消息体和表述消息的标签（比如指定交换器、路由键）。

### 消费者
订阅队列消费消息，消费者只会拿到消息体。

### Broker
RabbitMQ服务节点，生产者将消息存入Broker，消费者从Broker消费

### 队列（Queue）
RabbitMQ只能把消息存在队列中，多个消费者可以订阅同一个队列；但是消息会被均摊到消费者；  
RabbitMQ不支持队列层面的广播；RabbitMQ实现广播需要消费者订阅不同的队列，交换器把同一  
条消息投递到这些队列中。

### 交换器（Exchange）
消息的策略路由器，根据不同的路由策略将消息投递到不同的队列；并且可以和生产者完成消息传输确认。

### RoutingKey路由键
生产者发送消息时会指定一个RoutingKey，队列和交换器的绑定会指定一个BindingKey；一般消息会  
投递到BindingKey和RoutingKey一致的队列中。

### 绑定
交换器和队列依赖BindingKey进行关联。

### 交换器类型
fanout：交换器会把收到的消息发送到所有与之绑定的队列中。  
direct：消息会发送到 生产者指定的RoutingKey与BindingKey完全一致的队列中。  
topic：Bindingkey可以是模糊的（*，#模糊匹配），交换器根据RoutingKey和BindingKey的模糊匹配进行消息投递。  
headers：根据消息的headers属性匹配，不实用。


消息确认：生产者确认、消费者确认
顺序消费：因为网络原因导致消息丢失、生产者事务回滚，超时中断等都可能打破消息顺序消费；
需要业务方在消息体内加一个全局的有序标识来解决。
持久化
死信队列
延迟队列
镜像

